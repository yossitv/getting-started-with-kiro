(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}})();function E(e=10,t=20){return{grid:Array(t).fill(null).map(()=>Array(e).fill(null)),width:e,height:t}}function O(){return{board:E(),activeTetromino:null,nextTetromino:null,score:0,isPlaying:!1,isPaused:!1,isGameOver:!1}}const L={I:{shape:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],color:"#00f0f0"},O:{shape:[[1,1],[1,1]],color:"#f0f000"},T:{shape:[[0,1,0],[1,1,1],[0,0,0]],color:"#a000f0"},S:{shape:[[0,1,1],[1,1,0],[0,0,0]],color:"#00f000"},Z:{shape:[[1,1,0],[0,1,1],[0,0,0]],color:"#f00000"},J:{shape:[[1,0,0],[1,1,1],[0,0,0]],color:"#0000f0"},L:{shape:[[0,0,1],[1,1,1],[0,0,0]],color:"#f0a000"}};function G(e){const t=e.length,s=Array(t).fill(0).map(()=>Array(t).fill(0));for(let i=0;i<t;i++)for(let r=0;r<t;r++)s[r][t-1-i]=e[i][r];return s}const g=["I","O","T","S","Z","J","L"];function v(){const e=g[Math.floor(Math.random()*g.length)],t=L[e];return{type:e,shape:t.shape.map(s=>[...s]),position:{x:Math.floor((10-t.shape[0].length)/2),y:0},color:t.color}}function P(e,t){const{shape:s,position:i,color:r}=e;for(let n=0;n<s.length;n++)for(let o=0;o<s[n].length;o++)if(s[n][o]){const l=i.y+n,c=i.x+o;l>=0&&l<t.height&&c>=0&&c<t.width&&(t.grid[l][c]=r)}}function d(e,t,s=0,i=0){const{shape:r,position:n}=e;for(let o=0;o<r.length;o++)for(let l=0;l<r[o].length;l++)if(r[o][l]){const c=n.x+l+s,u=n.y+o+i;if(c<0||c>=t.width||u>=t.height||u>=0&&t.grid[u][c]!==null)return!0}return!1}function m(e,t,s,i){return!d(e,t,s,i)}function A(e,t,s){const i={...e,shape:t};return!d(i,s)}function S(e,t){return m(e,t,-1,0)?(e.position.x--,!0):!1}function b(e,t){return m(e,t,1,0)?(e.position.x++,!0):!1}function B(e,t){return m(e,t,0,1)?(e.position.y++,!0):!1}function I(e,t){const s=G(e.shape);return A(e,s,t)?(e.shape=s,!0):!1}function R(e){const t=[];for(let s=0;s<e.height;s++)e.grid[s].every(i=>i!==null)&&t.push(s);return t}function D(e,t){const s=[...t].sort((i,r)=>r-i);for(const i of s)e.grid.splice(i,1);for(let i=0;i<t.length;i++)e.grid.unshift(Array(e.width).fill(null))}function k(e){return[0,100,300,500,800][e]||0}class M{constructor(t){this.state=t,this.lastDropTime=0,this.dropInterval=1e3}startGame(){this.state.isPlaying=!0,this.state.isPaused=!1,this.state.isGameOver=!1,this.state.score=0,this.state.board.grid=Array(20).fill(null).map(()=>Array(10).fill(null)),this.state.nextTetromino=v(),this.spawnTetromino()}pauseGame(){this.state.isPlaying&&!this.state.isGameOver&&(this.state.isPaused=!0)}resumeGame(){this.state.isPlaying&&this.state.isPaused&&(this.state.isPaused=!1)}resetGame(){this.startGame()}update(t){!this.state.isPlaying||this.state.isPaused||this.state.isGameOver||t-this.lastDropTime>this.dropInterval&&(this.moveDownAction(),this.lastDropTime=t)}moveLeftAction(){return!this.state.activeTetromino||this.state.isPaused||this.state.isGameOver?!1:S(this.state.activeTetromino,this.state.board)}moveRightAction(){return!this.state.activeTetromino||this.state.isPaused||this.state.isGameOver?!1:b(this.state.activeTetromino,this.state.board)}moveDownAction(){return!this.state.activeTetromino||this.state.isPaused||this.state.isGameOver?!1:B(this.state.activeTetromino,this.state.board)?!0:(P(this.state.activeTetromino,this.state.board),this.clearCompletedLines(),this.spawnTetromino(),!1)}rotateAction(){return!this.state.activeTetromino||this.state.isPaused||this.state.isGameOver?!1:I(this.state.activeTetromino,this.state.board)}spawnTetromino(){this.state.activeTetromino=this.state.nextTetromino,this.state.nextTetromino=v(),this.state.activeTetromino&&d(this.state.activeTetromino,this.state.board)&&(this.state.isGameOver=!0,this.state.isPlaying=!1)}clearCompletedLines(){const t=R(this.state.board);t.length>0&&(D(this.state.board,t),this.state.score+=k(t.length))}}const a=30;class N{constructor(t,s,i,r,n){this.canvas=t,this.nextCanvas=s,this.scoreElement=i,this.gameOverElement=r,this.finalScoreElement=n,this.ctx=t.getContext("2d"),this.nextCtx=s.getContext("2d")}render(t){this.clearCanvas(),this.drawBoard(t),t.activeTetromino&&this.drawTetromino(t.activeTetromino),this.drawNextTetromino(t.nextTetromino),this.updateScore(t.score),this.updateGameOver(t)}clearCanvas(){this.ctx.fillStyle="#0f0f1e",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}drawBoard(t){for(let s=0;s<t.board.height;s++)for(let i=0;i<t.board.width;i++){const r=t.board.grid[s][i];r&&this.drawCell(i,s,r)}}drawTetromino(t){const{shape:s,position:i,color:r}=t;for(let n=0;n<s.length;n++)for(let o=0;o<s[n].length;o++)s[n][o]&&this.drawCell(i.x+o,i.y+n,r)}drawCell(t,s,i){this.ctx.fillStyle=i,this.ctx.fillRect(t*a,s*a,a,a),this.ctx.strokeStyle="#000",this.ctx.strokeRect(t*a,s*a,a,a)}drawNextTetromino(t){if(this.nextCtx.fillStyle="#0f0f1e",this.nextCtx.fillRect(0,0,this.nextCanvas.width,this.nextCanvas.height),!t)return;const{shape:s,color:i}=t,r=(4-s[0].length)/2,n=(4-s.length)/2;for(let o=0;o<s.length;o++)for(let l=0;l<s[o].length;l++)s[o][l]&&(this.nextCtx.fillStyle=i,this.nextCtx.fillRect((r+l)*a,(n+o)*a,a,a),this.nextCtx.strokeStyle="#000",this.nextCtx.strokeRect((r+l)*a,(n+o)*a,a,a))}updateScore(t){this.scoreElement.textContent=t.toString()}updateGameOver(t){t.isGameOver?(this.gameOverElement.classList.remove("hidden"),this.finalScoreElement.textContent=t.score.toString()):this.gameOverElement.classList.add("hidden")}}function Y(e){document.addEventListener("keydown",t=>{switch(t.key){case"ArrowLeft":t.preventDefault(),e.moveLeftAction();break;case"ArrowRight":t.preventDefault(),e.moveRightAction();break;case"ArrowUp":t.preventDefault(),e.rotateAction();break;case"ArrowDown":t.preventDefault(),e.moveDownAction();break;case" ":t.preventDefault(),e.state.isPaused?e.resumeGame():e.pauseGame();break}})}const x=document.getElementById("gameCanvas"),T=document.getElementById("nextCanvas"),q=document.getElementById("score"),F=document.getElementById("gameOver"),X=document.getElementById("finalScore"),y=document.getElementById("startBtn"),h=document.getElementById("pauseBtn"),w=document.getElementById("restartBtn");if(!x||!T)throw new Error("Canvas elements not found");const p=O(),f=new M(p),Z=new N(x,T,q,F,X);Y(f);y.addEventListener("click",()=>{f.startGame(),y.disabled=!0,h.disabled=!1,w.disabled=!1});h.addEventListener("click",()=>{p.isPaused?(f.resumeGame(),h.textContent="Pause"):(f.pauseGame(),h.textContent="Resume")});w.addEventListener("click",()=>{f.resetGame(),h.textContent="Pause",h.disabled=!1});function C(e){f.update(e),Z.render(p),requestAnimationFrame(C)}requestAnimationFrame(C);
