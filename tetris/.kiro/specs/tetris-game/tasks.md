# 実装計画

- [x] 1. プロジェクト構造とHTMLの基盤を作成
  - tetris-gameフォルダを作成
  - index.htmlファイルを作成し、Canvas要素、スコア表示、コントロールボタンを含める
  - 基本的なCSSスタイルを追加
  - _要件: 4.1, 4.4, 5.1_

- [x] 2. テトリミノのデータモデルと形状定義を実装
  - 7種類のテトリミノ（I、O、T、S、Z、J、L）の形状と色を定義
  - Tetrominoインターフェース/クラスを実装
  - 回転ロジック（rotateMatrix関数）を実装
  - _要件: 6.1, 6.3, 6.4_

- [x] 2.1 テトリミノ形状定義の単体テストを作成
  - 各テトリミノタイプが正しい形状を持つことを確認
  - 各テトリミノタイプが固有の色を持つことを確認
  - _要件: 6.1, 6.3_

- [x] 2.2 回転ロジックのプロパティテストを作成
  - **Property 2: 回転の形状保存**
  - **検証: 要件 1.3**

- [x] 2.3 回転後の形状整合性のプロパティテストを作成
  - **Property 10: 回転後の形状整合性**
  - **検証: 要件 6.4**

- [x] 3. ゲームボードとゲーム状態を実装
  - Boardインターフェース/クラスを実装（10x20グリッド）
  - GameStateインターフェース/クラスを実装
  - ボードの初期化ロジックを実装
  - _要件: 4.1_

- [x] 4. 衝突検出システムを実装
  - CollisionDetectorクラスを実装
  - checkCollisionメソッドを実装（壁、床、他のブロックとの衝突）
  - canMoveメソッドを実装
  - canRotateメソッドを実装
  - _要件: 1.5_

- [x] 4.1 衝突検出の単体テストを作成
  - 壁との衝突を確認
  - 床との衝突を確認
  - 他のブロックとの衝突を確認
  - _要件: 1.5_

- [x] 4.2 衝突時の位置不変性のプロパティテストを作成
  - **Property 3: 衝突時の位置不変性**
  - **検証: 要件 1.5**

- [x] 5. テトリミノの移動と回転機能を実装
  - moveLeft、moveRight、moveDown関数を実装
  - rotate関数を実装
  - 衝突検出と統合し、無効な移動を防止
  - _要件: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 5.1 テトリミノ移動の一貫性のプロパティテストを作成
  - **Property 1: テトリミノの移動の一貫性**
  - **検証: 要件 1.1, 1.2**

- [x] 6. テトリミノのランダム生成とロック機能を実装
  - ランダムなテトリミノを生成する関数を実装
  - テトリミノをボードにロックする関数を実装
  - 次のテトリミノのプレビュー機能を実装
  - _要件: 2.1, 2.3, 4.5, 6.2_

- [x] 6.1 テトリミノ生成のランダム性のプロパティテストを作成
  - **Property 9: テトリミノ生成のランダム性**
  - **検証: 要件 6.2**

- [x] 6.2 ロック後の生成のプロパティテストを作成
  - **Property 4: テトリミノのロック後の生成**
  - **検証: 要件 2.3**

- [x] 7. ライン削除とスコアシステムを実装
  - LineClearerクラスを実装
  - findCompleteLinesメソッドを実装
  - clearLinesメソッドを実装（ラインの削除とブロックの移動）
  - calculateScoreメソッドを実装（1ライン: 100点、2ライン: 300点、3ライン: 500点、4ライン: 800点）
  - _要件: 3.1, 3.2, 3.3, 3.4_

- [x] 7.1 ライン削除の単体テストを作成
  - 特定のボード状態でのライン検出を確認
  - ライン削除後のブロック移動を確認
  - _要件: 3.1, 3.2_

- [x] 7.2 完全なラインの削除と重力のプロパティテストを作成
  - **Property 5: 完全なラインの削除と重力**
  - **検証: 要件 3.1, 3.2**

- [x] 7.3 スコアの単調性のプロパティテストを作成
  - **Property 6: スコアの単調性**
  - **検証: 要件 3.3, 3.4**

- [x] 8. ゲームコントローラとゲームループを実装
  - GameControllerクラスを実装
  - startGame、pauseGame、resumeGame、resetGameメソッドを実装
  - updateメソッドを実装（自動落下ロジック）
  - requestAnimationFrameを使用したゲームループを実装
  - ゲームオーバー検出を実装
  - _要件: 2.2, 2.4, 5.1, 5.2, 5.3_

- [x] 8.1 ゲーム状態遷移の単体テストを作成
  - 開始、一時停止、再開、リセットの遷移を確認
  - ゲームオーバー条件を確認
  - _要件: 5.1, 5.2, 2.4_

- [x] 8.2 一時停止のトグル動作のプロパティテストを作成
  - **Property 7: 一時停止のトグル動作**
  - **検証: 要件 5.2**

- [x] 8.3 一時停止中の状態不変性のプロパティテストを作成
  - **Property 8: 一時停止中の状態不変性**
  - **検証: 要件 5.3**

- [x] 9. キーボード入力ハンドラを実装
  - キーボードイベントリスナーを追加
  - 矢印キー（左、右、上、下）の処理を実装
  - スペースキー（一時停止/再開）の処理を実装
  - ゲーム状態に応じた入力の有効化/無効化を実装
  - _要件: 1.1, 1.2, 1.3, 1.4, 5.2, 5.3_

- [x] 10. Canvas レンダラーを実装
  - CanvasRendererクラスを実装
  - ゲームボードの描画機能を実装
  - アクティブなテトリミノの描画機能を実装
  - ロックされたテトリミノの描画機能を実装
  - 次のテトリミノのプレビュー描画を実装
  - スコア表示の更新機能を実装
  - ゲームオーバーメッセージの表示を実装
  - _要件: 4.1, 4.2, 4.3, 4.4, 4.5, 5.4_

- [x] 11. すべてのコンポーネントを統合してゲームを完成
  - すべてのモジュールをindex.htmlにリンク
  - ゲームの初期化コードを実装
  - スタートボタンとリスタートボタンのイベントハンドラを接続
  - エラーハンドリングを追加（Canvas要素の確認など）
  - _要件: すべて_

- [x] 12. チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、問題があればユーザーに質問する

- [x] 13. 統合テストを作成
  - ゲーム全体のフロー（開始からゲームオーバーまで）をテストする
  - キーボード入力からレンダリングまでの完全なパイプラインをテストする
